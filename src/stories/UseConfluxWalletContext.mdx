import { Meta, Props } from "@storybook/addon-docs";

<Meta title="Tools/Hook useConfluxWalletContext " />

## useConfluxWalletContext hook

The `useConfluxWalletContext` facilitate you the interaction between wallets (Metamask or Fluent or OKX) and your dApp.
You no longer need to worry about which wallet the user is connected to, as you use the same API (sendTransaction, signMessage, ...) for all 3.
No matter whether the user is connected with Metamask, fluent or OKX Wallet, it's transparent for you and your code! An undisputed time-saver !

<br />
You can connect several wallets at once, but only one is considered as "active".
The `useConfluxWalletContext` hook only return functions and informations about the
**active** wallet. If you don't care with which wallets the user is connected , you
should always use functions and datas from this hook.

But because you might need to trigger functions or get data from specific providers, you also have access at any moment and everywhere on the app to the API of each provider, you can find more details on this [ page](?path=/docs/documentation-intro--docs#getting-started)

## How to use

After wrapping your application with the ConfluxWalletProvider as shown on the [introduction page](?path=/docs/documentation-intro--docs#getting-started), you can use the hook from anywhere in your application.

```jsx
import {
  useConfluxWalletContext,
} from "conflux-wallet-connect";


const MyComponent = () => {

 const { wallet } = useConfluxWalletContext();
 const { account, balance, chainId } = wallet;
  return (
    <p>
      The balance of the account {account} on {chainId} is {balance} ...
    <p>
  );
};
```

## Object and functions returned by the hook

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Description</th>
      <th>Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>wallet</td>
      <td>
        Object contains a set of the function and attributs to interact with the
        current wallet
      </td>
      <td>
          <a href="/?path=/docs/hooks-useconfluxwalletcontext--docs#wallet">Wallet</a>
      </td>
    </tr>

    <tr>
      <td>activeProvider</td>
      <td>
       Current active provider (wallet)
      </td>
      <td>
           <code>"metamask"</code> | <code>"okx"</code> | <code>
                "fluent" </code>|  <code>undefined</code>

      </td>
    </tr>
     <tr>
      <td>setActiveProvider</td>
      <td>
       Set current active provider
      </td>
      <td>
          <code>(provider: <a href="/?path=/docs/hooks-useconfluxwalletcontext--docs#wallet">ConfluxProvider</a>) => void;</code>
      </td>
    </tr>
     <tr>
      <td>isOpen</td>
      <td>
       if the connect modal isOpen
      </td>
      <td>
          <code>boolean</code>
      </td>
    </tr>
     <tr>
      <td>openModal</td>
      <td>
      Method to open the connect modal
      </td>
      <td>
          <code> () => void;</code>
      </td>
    </tr>
     <tr>
      <td>closeModal</td>
      <td>
      Method to close the connect modal
      </td>
      <td>
          <code> () => void;</code>
      </td>
    </tr>

  </tbody>
</table>

### Wallet object

        <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Type</th>
          </tr>
           </thead>
           <tbody>
          <tr>
            <td>status</td>
            <td>Status of the current active wallet</td>
            <td>

              <code>"in-detecting"</code> | <code>"not-installed"</code> | <code>
                "not-active"
              </code> |<code>"in-activating"</code> | <code>"active"</code> | <code>"chain-error"</code>
            </td>
          </tr>
          <tr>
            <td>account</td>
            <td>Adress of the acount connected on the current active wallet</td>
            <td>
              <code>string | undefined</code>
            </td>
          </tr>
          <tr>
            <td>chainId</td>
            <td>chainId of the current active wallet</td>
            <td>
              <code>string | undefined</code>
            </td>
          </tr>
          <tr>
            <td>balance</td>
            <td>Balance of the current active wallet</td>
            <td>
              <code><a href="/?path=/docs/hooks-useconfluxwalletcontext--docs#Unit"> Unit</a></code>
            </td>
          </tr>
          <tr>
            <td>connect</td>
            <td> - </td>
            <td> <code><a href="/?path=/docs/hooks-useconfluxwalletcontext--docs#connect"> See below</a></code></td>
          </tr>
       <tr>
            <td>addChain</td>
            <td> - </td>
            <td> <code><a href="/?path=/docs/hooks-useconfluxwalletcontext--docs#addChain"> See below</a></code></td>
          </tr>

 <tr>
            <td>completeDetect</td>
            <td> - </td>
            <td> <code><a href="/?path=/docs/hooks-useconfluxwalletcontext--docs#addChain"> See below</a></code></td>
          </tr>
           <tr>
            <td>personalSign</td>
            <td> - </td>
            <td> <code><a href="/?path=/docs/hooks-useconfluxwalletcontext--docs#addChain"> See below</a></code></td>
          </tr>
           <tr>
            <td>requestCrossNetworkPermission</td>
            <td> - </td>
            <td> <code><a href="/?path=/docs/hooks-useconfluxwalletcontext--docs#addChain"> See below</a></code></td>
          </tr>
           <tr>
            <td>sendTransaction</td>
            <td> - </td>
            <td> <code><a href="/?path=/docs/hooks-useconfluxwalletcontext--docs#sendTransaction"> See below</a></code></td>
          </tr>
           <tr>
            <td>switchChain</td>
            <td> - </td>
            <td> <code><a href="/?path=/docs/hooks-useconfluxwalletcontext--docs#switchChain"> See below</a></code></td>
          </tr>
             <tr>
            <td>trackBalanceChangeOnce</td>
            <td> - </td>
            <td> <code><a href="/?path=/docs/hooks-useconfluxwalletcontext--docs#trackBalanceChangeOnce"> See below</a></code></td>
          </tr>
             <tr>
            <td>watchAsset</td>
            <td> - </td>
            <td> <code><a href="/?path=/docs/hooks-useconfluxwalletcontext--docs#watchAsset"> See below</a></code></td>
          </tr>
             <tr>
            <td>setCrossNetworkChain</td>
            <td> - </td>
            <td> <code><a href="/?path=/docs/hooks-useconfluxwalletcontext--docs#setCrossNetworkChain"> See below</a></code></td>
          </tr>
           <tr>
            <td>provider</td>
            <td> - </td>
            <td> <code><a href="/?path=/docs/hooks-useconfluxwalletcontext--docs#provider"> See below</a></code></td>
          </tr>
          </tbody>
</table>

## Details of functions

# connect

```js

declare const connect: () => Promise<void>;

```

### Description:

The connect function return a Promise. when the status is 'not-active', calling connect brings up the wallet's authorization popup and the status changes to 'in-activating'.

After agreeing to the authorization, the status will change to 'active' and the return value in hooks such as useAccount will change from undefined to the corresponding value of the current account, and the returned Promise will resolve.

If the authorization is denied, or if connect is called when status is not 'not-active', Promise will be rejected; if it is called when status is already 'active', Promise will be resolved.

You should only allow users to call connect when the status is 'not-active' by clicking on the button.

# sendTransaction

```js

declare const sendTransaction: ({ from, to, value, data }: {
    to: string;
    value?: string;
    data?: string | undefined;
}) => Promise<string>;

```

### Description:

The sendTransaction function return a Promise. calling sendTransaction when the status is 'active' will raise the wallet to issue a transaction based on the input parameters. If it is not called when 'active', Promise will be rejected.

Unlike transactions initiated via RPC, sendTransaction only requires three parameters: to, value, and data (if any), and the from parameter is built into the current account.

The value should be a hexadecimal string starting with '0x', indicating the smallest unit of the corresponding currency ('drip' in conflux | 'wei' in ethereum). 'Undefined' value is equivalent to filling in '0x0'.

A successful transaction will resolve hash-string, a failed transaction will reject.

# addChain

```js

interface AddChainParameter {
    chainId: string; // A 0x-prefixed hexadecimal string
    chainName: string;
    nativeCurrency: {
        name: string;
        symbol: string; // 2-6 characters long
        decimals: number;
    };
    rpcUrls: string[];
    blockExplorerUrls?: string[];
    iconUrls?: string[]; // Currently ignored.
}

declare const addChain: (param: AddChainParameter) => Promise<null>;

```

### Description:

The addChain function return a Promise.calling addChain when the status is 'active' will invoke a wallet confirmation. If it is not called when 'active', the Promise will simply reject.

A successful add will resolve null, a failed add will reject.

# switchChain

```js

declare const switchChain: const switchChain: (chainId: string) => Promise<null>;

```

### Description:

The switchChain function return a Promise.calling switchChain when the status is 'active' will invoke a wallet confirmation. If it is not called when 'active', the Promise will simply reject.

A successful switch will resolve null, a failed switch will reject.

# watchAsset

```js

interface WatchAssetParams {
    type: 'ERC20'; // In the future, other standards will be supported
    options: {
        address: string; // The address of the token contract
        symbol: string; // A ticker symbol or shorthand, up to 5 characters
        decimals: number; // The number of token decimals
        image: string; // A string url of the token logo
    };
}

declare const watchAsset: (param: WatchAssetParams) => Promise<boolean>;

```

### Description:

The watchAsset function return a Promise.calling watchAsset when the status is 'active' will invoke a wallet confirmation. If it is not called when 'active', the Promise will simply reject.

A successful add will resolve true, a failed add may resolve false or reject.The behavior depends on the wallet.

# personalSign

```js

declare const personalSign: (message: string) => Promise<string>;

```

### Description:

The personalSign function return a Promise.calling personalSign when the status is 'active' will invoke a wallet confirmation. If it is not called when 'active', the Promise will simply reject.

A successful sign will resolve hash-string, a failed sign will reject.

# typedSign

```js

declare const typedSign: (typedData: Record<string, any>) => Promise<string>;

```

### Description:

The typedSign function return a Promise.calling typedSign when the status is 'active' will invoke a wallet confirmation. If it is not called when 'active', the Promise will simply reject.

A successful sign will resolve hash-string, a failed sign will reject.

# Unit

```js

declare class Unit {
    private value: Decimal;
    constructor(value: Decimal);
    equalsWith: (another: Unit) => boolean;
    toDecimalStandardUnit: (toFixed?: number | undefined, decimals: number = 18) => string;
    toHexStandardUnit: (decimals: number = 18) => string;
    toDecimalMinUnit: () => string;
    toHexMinUnit: () => string;
    static fromStandardUnit: (value: string | number, decimals: number = 18) => Unit;
    static fromMinUnit: (value: string | number) => Unit;
    static equals: (a: Unit, b: Unit) => boolean;
    static lessThan: (a: Unit, b: Unit) => boolean;
    static greaterThan: (a: Unit, b: Unit) => boolean;
    static lessThanOrEqualTo: (a: Unit, b: Unit) => boolean;
    static greaterThanOrEqualTo: (a: Unit, b: Unit) => boolean;
    static add: (a: Unit, b: Unit) => Unit;
    static sub: (a: Unit, b: Unit) => Unit;
    static mul: (a: Unit, b: Unit) => Unit;
    static div: (a: Unit, b: Unit) => Unit;
    equals: (another: Unit) => boolean;
    lessThan: (another: Unit) => boolean;
    greaterThan: (another: Unit) => boolean;
    lessThanOrEqualTo: (another: Unit) => boolean;
    greaterThanOrEqualTo: (another: Unit) => boolean;
    add: (another: Unit) => Unit;
    sub: (another: Unit) => Unit;
    mul: (another: Unit) => Unit;
    div: (another: Unit) => Unit;
    [Symbol.toPrimitive](hint: 'string' | 'number' | 'default'): string | Decimal;
}

```

### Description:

The balance type returned by useBalance is Unit, which is used to facilitate the development of Dapp to handle the problem of inconsistency between the balance displayed to the user and the balance unit required for issuing a transaction in a uniform manner.

The instance of Unit has a private member variable of value, meaning the smallest unit of the corresponding currency ('drip' in conflux | 'wei' in ethereum). It uses the library 'decimal.js' to perform calculations with sufficient precision.

You should use the Unit's static methods to get/calculate the value of the currency. Use the Unit's instance methods to display the value of the currency in the user interface.

MinUnit refers to 'drip' | 'wei', StandardUnit refers to 'cfx' | 'eth'. fromStandardUnit/MinUnit supports both hexadecimal strings starting with '0x' and decimal strings.

# watchAsset

```js

interface WatchAssetParams {
    type: 'ERC20'; // In the future, other standards will be supported
    options: {
        address: string; // The address of the token contract
        symbol: string; // A ticker symbol or shorthand, up to 5 characters
        decimals: number; // The number of token decimals
        image: string; // A string url of the token logo
    };
}

declare const watchAsset: (param: WatchAssetParams) => Promise<boolean>;

```

### Description:

The watchAsset function return a Promise.calling watchAsset when the status is 'active' will invoke a wallet confirmation. If it is not called when 'active', the Promise will simply reject.

A successful add will resolve true, a failed add may resolve false or reject.The behavior depends on the wallet.

# trackBalanceChangeOnce

```js
declare const trackBalanceChangeOnce: (callback: () => void) => void;

```

### Description:

The trackBalanceChangeOnce function tracks the change in the current account balance once.

This tool function can be used to simply and inexactly track whether a transaction has been on-chain or not.

# provider

```js
declare const provider: Provider | undefined;

```

### Description:

The trackBalanceChangeOnce function tracks the change in the current account balance once.

This tool function can be used to simply and inexactly track whether a transaction has been on-chain or not.

# completeDetect

```js
declare const completeDetect: () => Promise<void>;

```

### Description:

The 'provider' can be imported directly from use-wallet to use.It is the (conflux | ethereum) object in window. The difference is that it has a typescript declaration.

Note that the value of the imported provider object is undefined until the detect process is completed.
